<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="lv12.ico" type="image/x-icon">
</head>
<body class="bg-gray-100 min-h-screen">

  <div class="container mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6 text-center">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>

    <table class="w-full bg-white rounded shadow-md">
      <thead>
        <tr class="bg-gray-200">
          <th class="p-2">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
          <th class="p-2">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th class="p-2">Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th class="p-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th class="p-2">Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th class="p-2">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th class="p-2">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th class="p-2">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="orders-table">
      </tbody>
    </table>
  </div>

  <script>
    const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const ADMIN_EMAIL = "lv12wlv12@gmail.com"; 

    async function checkAuth() {
      const { data } = await supabase.auth.getSession();
      if (!data.session || data.session.user.email !== ADMIN_EMAIL) {
        alert("ğŸš« ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„");
        window.location.href = "index.html";
      }
    }

    checkAuth();

    async function loadOrders() {
      const { data: orders, error } = await supabase
        .from("orders")
        .select("id, name, phone, address, quantity, status, product_id, products(name)")
        .order("id", { ascending: false });

      if (error) {
        console.error(error);
        return;
      }

      const table = document.getElementById("orders-table");
      table.innerHTML = "";

      orders.forEach(order => {
        table.innerHTML += `
          <tr class="border-b">
            <td class="p-2">${order.id}</td>
            <td class="p-2">${order.name}</td>
            <td class="p-2">${order.phone}</td>
            <td class="p-2">${order.address}</td>
            <td class="p-2">${order.products?.name || "Ù…Ù†ØªØ¬ Ù…Ø­Ø°ÙˆÙ"}</td>
            <td class="p-2">${order.quantity}</td>
            <td class="p-2">
              <span class="px-2 py-1 rounded ${
                order.status === "delivered" ? "bg-green-200 text-green-800" : 
                order.status === "shipped" ? "bg-blue-200 text-blue-800" : 
                "bg-yellow-200 text-yellow-800"
              }">${order.status}</span>
            </td>
            <td class="p-2">
              <button onclick="updateStatus(${order.id}, 'shipped')" class="bg-blue-500 text-white px-2 py-1 rounded">ğŸšš Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´Ø­Ù†</button>
              <button onclick="updateStatus(${order.id}, 'delivered')" class="bg-green-500 text-white px-2 py-1 rounded">âœ… ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
              <button onclick="updateStatus(${order.id}, 'cancelled')" class="bg-red-500 text-white px-2 py-1 rounded">âŒ Ø¥Ù„ØºØ§Ø¡</button>
            </td>
          </tr>
        `;
      });
    }

    async function updateStatus(orderId, newStatus) {
      const { error } = await supabase
        .from("orders")
        .update({ status: newStatus })
        .eq("id", orderId);

      if (error) {
        alert("âŒ Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨");
        console.error(error);
      } else {
        alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨");
        loadOrders();
      }
    }

    loadOrders();
  </script>
</body>
</html>
